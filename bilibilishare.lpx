/*
 *
 *
#!name= å“”å“©å“”å“© ğ•
#!desc= å¯¹å“”å“©å“”å“©æ·±åº¦å­¦ä¹ æ¢ç´¢;
#!homepage = https://apps.apple.com/app/id1517062289
#!icon= https://is1-ssl.mzstatic.com/image/thumb/Purple221/v4/7c/c5/16/7cc516f1-6252-3a4f-808e-338b6dfea663/AppIcon-inter-1x_U007ephone-0-0-0-85-220-0.png/114x114bb.jpg

[Argument]
VIP = switch, false, tag = [å¯ç”¨]ä¼šå‘˜, desc = å…³é—­å¼€å…³å°†ä¸å¯¹æ­¤é€‰é¡¹ç”Ÿæ•ˆ

Authorization = input, "", tag = Authorization ,desc = é€‰å¡«
UserAgent = input, "", tag = User-Agent, desc = é€‰å¡«

[Rule]

[Rewrite]

[Script]
http-request ^https?:\/\/(?:grpc\.biliapi\.net|app\.bilibili\.com|app\.biliapi\.net)\/(?:bilibili\.app\.(?:playerunite\.v1\.Player\/PlayViewUnite|playurl\.v1\.PlayURL\/PlayView)|bilibili\.pgc\.gateway\.player\.v2\.PlayURL\/PlayView) script-path=https://he2o.vercel.app/Resource/Plugin/Bilibili.js, binary-body-mode=true, requires-body=true, timeout=60, tag=ä¼šå‘˜, enable={VIP}, argument=[{Authorization},{UserAgent}]
http-response ^https?:\/\/app\.bilibili\.com\/x\/v\d\/(account\/(myinfo|mine)|(feed\/index))\? script-path=https://he2o.vercel.app/Resource/Plugin/Bilibili.js, requires-body=true, timeout=60, tag=ç”»è´¨, enable={VIP}, argument=[{Authorization},{UserAgent}]

[Mitm]
hostname = *.bilibili.*,*.biliapi.*
*
*
*/






const url = $request.url;
const header = $request.headers;

const authorization = $argument?.Authorization;
const userAgent = $argument?.UserAgent;

if (!authorization || !userAgent) {

    console.log("å‚æ•°ç¼ºå¤±ä¿¡æ¯ï¼š");
    if (!authorization) console.log("âŒ Authorization å‚æ•°ç¼ºå¤±");
    if (!userAgent) console.log("âŒ UserAgent å‚æ•°ç¼ºå¤±");

    $notification.post(
        "å“”å“©å“”å“©é‡åˆ°é—®é¢˜",
        "å‚æ•°ç¼ºå¤±",
        "è¯·åœ¨æ’ä»¶å†…å¡«å…¥ä¼šå‘˜æ•°æ®"
    );

    $done({});
    return;
}

header["authorization"] = authorization;
header["user-agent"] = userAgent;

console.log("âœ… å“”å“©å“”å“©å¤§ä¼šå‘˜å·²è§£é” ğŸ‰");